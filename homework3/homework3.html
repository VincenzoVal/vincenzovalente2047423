---
layout: default
title: The RSA Cipher, Encryption and Frequency Analysis
---

<h2>The RSA Cipher: An Asymmetric Cryptosystem</h2>
<p>
The <strong>RSA (Rivest–Shamir–Adleman) cipher</strong> is a public-key cryptosystem and one of the first and most widely used systems for secure data transmission. 
RSA uses a pair of keys: a <strong>public key</strong> for encryption and a <strong>private key</strong> for decryption (asymmetric).
</p>
<p>
The security of RSA relies on the computational difficulty of factoring large integers—specifically, finding the two large prime factors of a very large composite number. 
For this demonstration, we’ll use small primes to make the math manageable.
</p>

<hr>

<h2>RSA Key Generation Steps</h2>
<ol>
    <li><strong>Choose two distinct prime numbers, p and q</strong> (e.g., p=13, q=17).</li>
    <li><strong>Compute the modulus N = p * q</strong></li>
    <li><strong>Compute Euler's totient φ(N) = (p - 1) * (q - 1)</strong></li>
    <li><strong>Choose the public exponent e</strong> such that gcd(e, φ(N)) = 1.</li>
    <li><strong>Compute the private key d</strong> such that (e × d) ≡ 1 (mod φ(N)).</li>
</ol>

<hr>

<h2>Interactive RSA Cipher Tool</h2>

<div style="display: flex; flex-wrap: wrap; gap: 20px; margin-bottom: 20px; align-items: flex-end;">
    <!-- Prime p input and generate button -->
    <div style="flex: 1; min-width: 200px;">
        <label><strong>Prime p:</strong></label><br>
        <input type="number" id="p_input" value="13" style="width: 100%;">
        <button id="generatePButton" style="width: 100%; margin-top: 5px;">Generate p</button>
    </div>
    <!-- Prime q input and generate button -->
    <div style="flex: 1; min-width: 200px;">
        <label><strong>Prime q:</strong></label><br>
        <input type="number" id="q_input" value="17" style="width: 100%;">
        <button id="generateQButton" style="width: 100%; margin-top: 5px;">Generate q</button>
    </div>
    <!-- Public key e input aligned with p and q -->
    <div style="flex: 1; min-width: 200px;">
        <label><strong>Public Key e:</strong></label><br>
        <input type="number" id="e_input" value="11" style="width: 100%;">
    </div>
</div>

<!-- Buttons for helper functions -->
<div style="margin-top: 10px;">
    <button id="showHelpersButton">Show Helper Functions</button>
</div>

<div id="helpersCodeBox" style="display:none; background:#f8f8f8; border:1px solid #ccc; padding:10px; margin-top:10px;">
    <pre><code id="helpersCodeContent"></code></pre>
</div>

<div style="margin-bottom: 15px;">
    <label><strong>Plaintext Input:</strong></label><br>
    <textarea id="plaintextInput" rows="4" style="width: 100%; box-sizing: border-box;" placeholder="Enter your message..."></textarea>
</div>

<div style="margin-top: 10px;">
    <button id="encryptButton">Encrypt & Analyze</button>
    <button id="showEncryptCodeButton" style="margin-left: 10px;">Show Cifratura Code</button>
    <button id="showDecryptCodeButton" style="margin-left: 10px;">Show Decifratura Code</button>
</div>

<!-- Boxes for showing code -->
<div id="encryptCodeBox" style="display:none; background:#f8f8f8; border:1px solid #ccc; padding:10px; margin-top:10px;">
    <pre><code id="encryptCodeContent"></code></pre>
</div>
<div id="decryptCodeBox" style="display:none; background:#f8f8f8; border:1px solid #ccc; padding:10px; margin-top:10px;">
    <pre><code id="decryptCodeContent"></code></pre>
</div>

<div style="margin-top: 15px;">
    <label><strong>Ciphertext Output (Numerical Blocks):</strong></label><br>
    <textarea id="ciphertextOutput" rows="4" style="width: 100%;" readonly></textarea>
</div>

<p style="margin-top: 15px;">
    <strong>Calculated Modulus N:</strong> <span id="modulusN" style="font-weight: bold;">(Click Encrypt)</span>
</p>

<p>
    <strong>Calculated Private Key d:</strong> <span id="privateD" style="font-weight: bold;">(Click Encrypt)</span>
</p>

<hr>

<h2>Cryptanalysis: Decoding with Frequency Analysis</h2>

<div style="display: flex; flex-wrap: wrap; gap: 20px; margin-top: 15px;">
    <div style="flex: 1; min-width: 300px;">
        <h4>Plaintext Letter Distribution</h4>
        <canvas id="plaintextChart"></canvas>
    </div>
    <div style="flex: 1; min-width: 300px;">
        <h4>Ciphertext Numerical Block Distribution</h4>
        <canvas id="ciphertextChart"></canvas>
    </div>
</div>

<div style="margin-top: 15px;">
    <label><strong>Decoded Text (Substitution Attack):</strong></label><br>
    <textarea id="decryptedTextAttackOutput" rows="4" style="width: 100%;" readonly></textarea>
</div>

<hr>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
document.addEventListener("DOMContentLoaded", () => {

    // -----------------------
    // --- Helper Functions ---
    // -----------------------

    // Check if number is prime
    function isPrime(num) {
        if (num < 2) return false;
        for (let i = 2; i <= Math.sqrt(num); i++) {
            if (num % i === 0) return false;
        }
        return true;
    }

    // Greatest common divisor
    function gcd(a, b) {
        return b === 0 ? a : gcd(b, a % b);
    }

    // Modular inverse (used for private key calculation)
    function modInverse(e, phi) {
        let [a, b, x0, x1] = [phi, e, 0, 1];
        while (b !== 0) {
            let q = Math.floor(a / b);
            [a, b, x0, x1] = [b, a % b, x1 - q * x0, x0];
        }
        return (x1 + phi) % phi;
    }

    // Generate random prime between min and max
    function generateRandomPrime(min = 11, max = 97) {
        let prime = Math.floor(Math.random() * (max - min + 1)) + min;
        while (!isPrime(prime)) {
            prime = Math.floor(Math.random() * (max - min + 1)) + min;
        }
        return prime;
    }

    // Event listeners for generating p and q
    document.getElementById("generatePButton").addEventListener("click", () => {
        document.getElementById("p_input").value = generateRandomPrime();
    });
    document.getElementById("generateQButton").addEventListener("click", () => {
        document.getElementById("q_input").value = generateRandomPrime();
    });

    // -------------------------
    // --- RSA Encryption ---
    // -------------------------

    function rsaEncryptArray(text, e, n) {
        const lower = String(text).toLowerCase().replace(/[^a-z]/g, "");
        const ciphertext = [];
        for (const char of lower) {
            const m = char.charCodeAt(0);
            const c = (BigInt(m) ** BigInt(e)) % BigInt(n);
            ciphertext.push(c.toString());
        }
        return ciphertext;
    }

    function rsaDecryptArray(cipherArray, d, n) {
        const text = [];
        for (const val of cipherArray) {
            const m = (BigInt(val) ** BigInt(d)) % BigInt(n);
            text.push(String.fromCharCode(Number(m)));
        }
        return text.join("");
    }

    // -------------------------
    // --- Frequency Analysis ---
    // -------------------------

    function letterDistribution(str) {
        const freq = {};
        const letters = str.toLowerCase().replace(/[^a-z]/g, "");
        for (const char of letters) freq[char] = (freq[char] || 0) + 1;
        const total = letters.length;
        const dist = {};
        for (const [char, count] of Object.entries(freq)) {
            dist[char] = ((count / total) * 100).toFixed(2);
        }
        return dist;
    }

    function cipherDistribution(cipherArray) {
        const freq = {};
        for (const val of cipherArray) freq[val] = (freq[val] || 0) + 1;
        const total = cipherArray.length;
        const dist = {};
        for (const [num, count] of Object.entries(freq)) {
            dist[num] = ((count / total) * 100).toFixed(2);
        }
        return dist;
    }

    function decryptByDistribution(cipherDist, plainDist, cipherArray) {
        const sortedPlain = Object.entries(plainDist).sort((a, b) => parseFloat(b[1]) - parseFloat(a[1]));
        const sortedCipher = Object.entries(cipherDist).sort((a, b) => parseFloat(b[1]) - parseFloat(a[1]));
        const map = {};
        for (let i = 0; i < Math.min(sortedPlain.length, sortedCipher.length); i++) {
            const [plainChar] = sortedPlain[i];
            const [cipherVal] = sortedCipher[i];
            map[cipherVal] = plainChar;
        }
        let decryptedText = "";
        for (const val of cipherArray) decryptedText += map[val] || "?";
        return { decryptedText };
    }

    // -------------------------
    // --- Chart Updates ---
    // -------------------------
    let plaintextChartInstance = null;
    let ciphertextChartInstance = null;

    function updateCharts(plaintext, cipherFreq) {
        const labels = "abcdefghijklmnopqrstuvwxyz".split("");
        const plainFreq = letterDistribution(plaintext);
        const plainValues = labels.map(l => parseFloat(plainFreq[l] || 0));
        const cipherLabels = Object.keys(cipherFreq);
        const cipherValues = Object.values(cipherFreq).map(v => parseFloat(v));

        if (plaintextChartInstance) plaintextChartInstance.destroy();
        plaintextChartInstance = new Chart(document.getElementById("plaintextChart"), {
            type: "bar",
            data: { labels, datasets: [{ label: "Frequency %", data: plainValues, backgroundColor: "lightblue" }] },
            options: { responsive: true, plugins: { legend: { display: false } } }
        });

        if (ciphertextChartInstance) ciphertextChartInstance.destroy();
        ciphertextChartInstance = new Chart(document.getElementById("ciphertextChart"), {
            type: "bar",
            data: { labels: cipherLabels, datasets: [{ label: "Frequency %", data: cipherValues, backgroundColor: "lightcoral" }] },
            options: { responsive: true, plugins: { legend: { display: false } } }
        });
    }

    // -------------------------
    // --- Button Handlers ---
    // -------------------------

    document.getElementById("encryptButton").addEventListener("click", () => {
        const p = parseInt(document.getElementById("p_input").value);
        const q = parseInt(document.getElementById("q_input").value);
        const e = parseInt(document.getElementById("e_input").value);

        const N = p * q;
        const phi = (p - 1) * (q - 1);

        let d = modInverse(e, phi);
        if (d === 0) d = 1; // fallback for small numbers

        const plaintext = document.getElementById("plaintextInput").value;
        const cipherArray = rsaEncryptArray(plaintext, e, N);
        const cipherTextStr = cipherArray.join(" ");

        document.getElementById("ciphertextOutput").value = cipherTextStr;
        document.getElementById("modulusN").textContent = N;
        document.getElementById("privateD").textContent = d;

        const plainFreq = letterDistribution(plaintext);
        const cipherFreq = cipherDistribution(cipherArray);
        updateCharts(plaintext, cipherFreq);

        const attackResult = decryptByDistribution(cipherFreq, plainFreq, cipherArray);
        document.getElementById("decryptedTextAttackOutput").value = attackResult.decryptedText;
    });

    // Show/Hide encryption code
    const showEncryptCodeBtn = document.getElementById("showEncryptCodeButton");
    const encryptCodeBox = document.getElementById("encryptCodeBox");
    const encryptCodeContent = document.getElementById("encryptCodeContent");
    encryptCodeContent.textContent = `function rsaEncryptArray(text, e, n) { ... }`;
    showEncryptCodeBtn.addEventListener("click", () => {
        encryptCodeBox.style.display = encryptCodeBox.style.display === "none" ? "block" : "none";
    });

    // Show/Hide decryption code
    const showDecryptCodeBtn = document.getElementById("showDecryptCodeButton");
    const decryptCodeBox = document.getElementById("decryptCodeBox");
    const decryptCodeContent = document.getElementById("decryptCodeContent");
    decryptCodeContent.textContent = `function rsaDecryptArray(cipherArray, d, n) { ... }`;
    showDecryptCodeBtn.addEventListener("click", () => {
        decryptCodeBox.style.display = decryptCodeBox.style.display === "none" ? "block" : "none";
    });

    // Show/Hide helper functions
    const helpersBtn = document.getElementById("showHelpersButton");
    const helpersBox = document.getElementById("helpersCodeBox");
    const helpersCode = `function isPrime(num) { ... }\nfunction gcd(a, b) { ... }\nfunction modInverse(e, phi) { ... }`;
    helpersBtn.addEventListener("click", () => {
        helpersBox.style.display = helpersBox.style.display === "none" ? "block" : "none";
        if (helpersBox.style.display === "block") document.getElementById("helpersCodeContent").textContent = helpersCode;
    });

});
</script>
